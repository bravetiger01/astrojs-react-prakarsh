---
import PixiCanvas from "@/components/PixiCanvas.astro";
import Mobile from "../components/Mobile.astro";
import Layout from "../layouts/Layout.astro";
import MobileLayout from "../layouts/MobileLayout.astro";

/* Read headers (works on Vercel SSR) */
const ua = Astro.request.headers.get("user-agent") ?? "";

/* Simple, safe UA check */
const isMobile =
  /Android|iPhone|iPod/i.test(ua) ||
  (/iPad/i.test(ua) && !/Macintosh/i.test(ua));

// Server-side logs
console.log("üîç [SERVER] index.astro - isMobile:", isMobile);
---

{
  isMobile ? (
    <MobileLayout>
      <Mobile />
    </MobileLayout>
  ) : (
    <Layout>
      <PixiCanvas />
    </Layout>
  )
}

<!-- Optional: client-side correction for edge cases -->
<script>
  const isDesktopClient = window.matchMedia(
    "(min-width: 1024px) and (pointer: fine)",
  ).matches;

  document.documentElement.dataset.device = isDesktopClient
    ? "desktop"
    : "mobile";
    
</script>

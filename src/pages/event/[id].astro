---
export const prerender = true;

import PageLayout from "../../layouts/PageLayout.astro";
import EventPage from "../../components/TechEventDetailPage";
import NonTechEventDetailPage from "../../components/NonTechEventDetailPage";
import EsportsEventDetailPage from "../../components/EsportsEventDetailPage";
import { fetchAllEvents } from "../../lib/api";

// For static build, we need to generate paths for all events from Supabase
export async function getStaticPaths() {
  const allEvents = await fetchAllEvents();

  return allEvents.map((event) => ({
    params: { id: event.id },
    props: { category: event.category, eventId: event.id },
  }));
}

const { id } = Astro.params;
const { category, eventId } = Astro.props;

// Use the eventId from props, which is guaranteed to be correct
const finalEventId = eventId || id;
---

<PageLayout title="Event Details - Prakarsh '26" showDesktopNav={false}>
  {
    category === "esports" && (
      <EsportsEventDetailPage client:load eventId={finalEventId} />
    )
  }
  {
    (category === "non-tech" || category === "workshops") && (
      <NonTechEventDetailPage client:load eventId={finalEventId} />
    )
  }
  {category === "tech" && <EventPage client:load eventId={finalEventId} />}
</PageLayout>

---
/* IMPORTANT: disables static generation */
export const prerender = false;

import Desktop from "../components/Desktop.astro";
import Mobile from "../components/Mobile.astro";
import Layout from "../layouts/Layout.astro";

/* Read headers (works on Vercel SSR) */
const ua = Astro.request.headers.get("user-agent") ?? "";

/* Simple, safe UA check */
const isMobile =
  /Android|iPhone|iPod/i.test(ua) ||
  (/iPad/i.test(ua) && !/Macintosh/i.test(ua));
---

<Layout>
  {isMobile ? <Mobile /> : <Desktop />}
</Layout>

<!-- Optional: client-side correction for edge cases -->
<script>
  const isDesktopClient = window.matchMedia(
    "(min-width: 1024px) and (pointer: fine)"
  ).matches;

  document.documentElement.dataset.device =
    isDesktopClient ? "desktop" : "mobile";
</script>